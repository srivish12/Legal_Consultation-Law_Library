{% extends 'base.html' %}
{% load static %}
{% block title %}My Subscription{% endblock %}


{% block corecss %}
{{ block.super }}
<style>
    body {
        background: url('/media/my-page.jpeg') no-repeat center center fixed;
        background-size: cover;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        
    }

    .hero-overlay {
        background: rgba(0, 0, 0, 0.65);
        border-radius: 1rem;
    }

    .card {
        transition: transform .2s ease, box-shadow .2s ease;
        margin-bottom: 1rem;
        font-weight: 500;
    }

    
</style>
{% endblock %}



{% block page_header %}
<div class="container my-4 col-md-8 col-lg-6 hero-overlay p-4 text-center text-white">
    <div class="row">
        <div class=" col text-center ">
            <h1 class="fw-bold">My Subscription</h1>
            <p class="text-white">
                View and manage your subscription details and purchased consultation packages
            </p>
        </div>
    </div>
</div>
<hr>
<hr>
{% endblock %}


{% block content %}


<div class="card p-4 mb-4">
    <h4>User Information</h4>
    <p><strong>Username:</strong> {{ user.username }}</p>
    <p><strong>Email:</strong> {{ user.email }}</p>
</div>

<div class="card p-4 mb-4">
    <h4>Subscription Details</h4>

    <p>
        <strong>Plan:</strong>
        {{ subscription.get_plan_display }}
    </p>

    <p>
        <strong>Start Date:</strong>
        {{ subscription.started_at|date:"Y-m-d" }}
    </p>

    <p>
        <strong>End Date:</strong>
        {% if subscription.expires_at %}
        {{ subscription.expires_at|date:"Y-m-d" }}
        {% else %}
        —
        {% endif %}
    </p>

    <p>
        <strong>Status:</strong>
        {% if subscription.expires_at and subscription.expires_at > today %}
        <span class="badge bg-success">Active</span>
        {% else %}
        <span class="badge bg-danger">Expired</span>
        {% endif %}
    </p>

    <a href="{% url 'subscriptions:list' %}" class="btn btn-outline-primary">
        Manage Subscription
    </a>
</div>

<div class="card p-4">
    <h4>Bought Consultation Packages</h4>

    {% if bought_packages %}
    <table class="table table-bordered mt-3">
        <thead>
            <tr>
                <th>lawyer</th>
                <th>type</th>
                <th>specialty</th>
                <th>Package</th>
                <th>Price Paid</th>
                <th>Purchased On</th>
            </tr>
        </thead>
        <tbody>
            {% for payment in bought_packages %}
            <tr>
                <td>{{ payment.package.lawyer.name}}</td>
                <td>{{ payment.package.lawyer.get_lawyer_type_display }}</td>
                <td>{{ payment.package.lawyer.get_specialty_display }}</td>
                <td>{{ payment.package.title }}</td>
                <td>£{{ payment.final_amount }}</td>
                <td>{{ payment.created_at|date:"Y-m-d" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted mt-3">No consultation packages purchased yet.</p>
    {% endif %}

    <a href="{% url 'payments:history' %}" class="btn btn-outline-primary">
        Manage Consultation Packages
    </a>

</div>

{% endblock %}