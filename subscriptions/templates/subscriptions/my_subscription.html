{% extends 'base.html' %}
{% load static %}
{% block title %}My Subscription{% endblock %}

{% block content %}
<h1 class="mb-4">My Subscription</h1>

<div class="card p-4 mb-4">
    <h4>User Information</h4>
    <p><strong>Username:</strong> {{ user.username }}</p>
    <p><strong>Email:</strong> {{ user.email }}</p>
</div>

<div class="card p-4 mb-4">
    <h4>Subscription Details</h4>

    <p>
        <strong>Plan:</strong>
        {{ subscription.get_plan_display }}
    </p>

    <p>
        <strong>Start Date:</strong>
        {{ subscription.started_at|date:"Y-m-d" }}
    </p>

    <p>
        <strong>End Date:</strong>
        {% if subscription.expires_at %}
        {{ subscription.expires_at|date:"Y-m-d" }}
        {% else %}
        —
        {% endif %}
    </p>

    <p>
        <strong>Status:</strong>
        {% if subscription.expires_at and subscription.expires_at > today %}
        <span class="badge bg-success">Active</span>
        {% else %}
        <span class="badge bg-danger">Expired</span>
        {% endif %}
    </p>

    <a href="{% url 'subscriptions:list' %}" class="btn btn-outline-primary">
        Manage Subscription
    </a>
</div>

<div class="card p-4">
    <h4>Bought Consultation Packages</h4>

    {% if bought_packages %}
    <table class="table table-bordered mt-3">
        <thead>
            <tr>
                <th>lawyer</th>
                <th>type</th>
                <th>specialty</th>
                <th>Package</th>
                <th>Price Paid</th>
                <th>Purchased On</th>
            </tr>
        </thead>
        <tbody>
            {% for payment in bought_packages %}
            <tr>
                <td>{{ payment.package.lawyer.name}}</td>
                <td>{{ payment.package.lawyer.get_lawyer_type_display }}</td>
                <td>{{ payment.package.lawyer.get_specialty_display }}</td>
                <td>{{ payment.package.title }}</td>
                <td>£{{ payment.final_amount }}</td>
                <td>{{ payment.created_at|date:"Y-m-d" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted mt-3">No consultation packages purchased yet.</p>
    {% endif %}

    <a href="{% url 'payments:history' %}" class="btn btn-outline-primary">
        Manage Consultation Packages
    </a>

</div>

{% endblock %}