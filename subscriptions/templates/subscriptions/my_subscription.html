{% extends 'base.html' %}
{% load static %}
{% block title %}My Subscription{% endblock %}


{% block extra_css %}
    <link rel="stylesheet" href="{% static 'subscriptions/css/my_sub.css' %}">
    
{% endblock %}


{% block page_header %}
<div class="container my-4 col-md-8 col-lg-6 hero-overlay p-4 text-center text-white">
    <div class="row">
        <div class=" col text-center ">
            <!-- My Subscription(Profile)  -->
            <h1 class="fw-bold">My Subscription Profile</h1>
            <p class="text-white">
                View and manage your subscription details and purchased consultation packages
            </p>
        </div>
    </div>
</div>
<hr>
<hr>
{% endblock %}


{% block content %}


<div class="card p-4 mb-4">
    <h4>User Information</h4>
    <p><strong>Username:</strong> {{ user.username }}</p>
    <p><strong>Email:</strong> {{ user.email }}</p>
</div>

<div class="card p-4 mb-4">
    <h4>Subscription Details</h4>

    {% if subscription %}
        {{ subscription.get_plan_display }}
    {% else %}
        No Subscription
    {% endif %}

<p><strong>Start Date:</strong>
        {{ subscription.started_at|date:"Y-m-d" }}
    </p>

    <p><strong>End Date:</strong>
        {% if subscription.expires_at %}
            {{ subscription.expires_at|date:"Y-m-d" }}
        {% else %}
            —
        {% endif %}
    </p>

    <p><strong>Status:</strong>
        {% if subscription and subscription.is_active %}
            <span class="badge bg-success">Active</span>
        {% else %}
            <span class="badge bg-danger">Expired</span>
        {% endif %}
    </p>

    

    <a href="{% url 'subscriptions:list' %}" class="btn btn-outline-primary">
        Manage Subscription
    </a>
</div>

<div class="card p-4">
    <h4>Bought Consultation Packages</h4>

    {% if bought_packages %}
    <div class="table-responsive">
    

    <table class="table table-bordered mt-3">
        <thead>
            <tr>
                <th>lawyer</th>
                <th>type</th>
                <th>specialty</th>
                <th>Package</th>
                <th>Price Paid</th>
                <th>Purchased On</th>
            </tr>
        </thead>
        <tbody class="table-body">
            {% for payment in bought_packages %}
            <tr>
                <td>{{ payment.package.lawyer.name}}</td>
                <td>{{ payment.package.lawyer.get_lawyer_type_display }}</td>
                <td>{{ payment.package.lawyer.get_specialty_display }}</td>
                <td>{{ payment.package.title }}</td>
                <td>£{{ payment.final_amount }}</td>
                <td>{{ payment.created_at|date:"Y-m-d" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
    {% else %}
    <p class="text-muted mt-3">No consultation packages purchased yet.</p>
    {% endif %}

    <a href="{% url 'payments:history' %}" class="btn btn-outline-primary">
        Manage Consultation Packages
    </a>

</div>

{% endblock %}